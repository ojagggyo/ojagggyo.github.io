<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <script src="https://github.com/steemit/steem-js/releases/download/v0.6.4/steem.min.js"></script> 
        <title>Follower Checker</title>

        <script>
            let username;
            let storage_username;
            let defaultHtml = '<div style="height:150px; padding-top:55px;padding-bottom:55px;"><button type="button" class="btn btn-success" style="margin:3px;">followers: 0</button><button type="button" class="btn btn-warning" style="margin:3px;">unfollowers: 0</button></div>';
           
            window.onload = function() {
                storage_username = localStorage.getItem("username");
                let previous_count = localStorage.getItem("follower_count");
                previous_count = previous_count === null ? 0 : previous_count;
                $("#text_username").val(storage_username);
                $("#past_sub").text("number of followers: " + previous_count);
                steem.api.setOptions({url: 'https://api.steemit.com'});
                getAccountCount();
                getSteemPrice();
                getVotingPowerPercent();
                loadSelectBox();
            };
            function loadSelectBox(){
                username = $("#text_username").val();
                if(username === ""){
                    return;
                }
                steem.api.getDiscussionsByBlog({tag: username, limit: 20}, function(err, result) {
                    let text = "";
                    for(let i = 0; i < result.length; i++){
                        if(result[i].author === username){
                            text += '<option value="' + result[i].permlink+ '">' + result[i].title + '</option>';
                        }
                    }
                    if(result.length == 0) {
                        $("#selectPerm").html("");
                        $("#votingListButton").text("");
                        $("#votingListButton").val("");
                        return;
                    }
                    $("#selectPerm").html(text);
                    getVoting("SBD");
                });
            }
            function getAccountCount(){
                steem.api.getAccountCount(function(err, result) {
                    $("#steemitUser").text(result);
                });
            }
            function getSteemPrice() {
                steem.api.getCurrentMedianHistoryPrice(function(err, result) {
                    let steemPrice = parseFloat(result.base.replace(" SBD"));
                    $("#steemPrice").text("$" + steemPrice);
                });
            }

    
        </script>
    </head>
    <body>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <div class="container">
            <div class="d-flex" style="font-size:small;">
                <div class="mr-auto p-2">
                    <span class="p-2" id="steemitUser" onclick="getAccountCount();"></span>
                    <span class="" id="steemPrice" onclick="getSteemPrice();"></span>
                </div>
                <div class="p-2" onclick="getVotingPowerPercent();">
                    <span class="p-2" id="userSP"></span>
                    <span id="votingSBD"></span>
                    <span class="p-2" id="votingPowerP"></span>
                    <span id="timeLeft"></span>
                </div>
            </div>
          

        </div>
    </body>
</html>
