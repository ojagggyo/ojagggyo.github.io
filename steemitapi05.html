<!doctype html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="utf-8">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://github.com/steemit/steem-js/releases/download/v0.7.7/steem.min.js"></script>       
        <script>

            var username;
            function saveUserName(){
                username = window.location.hash;// #username
                //console.log("username["+username+"]");
                if (username == null || username.trim().length == 0){
                    username = "#steemitblog";
                }
                
                username = username.substr(1);//#を取る
                username = decodeURI(username).trim();//デコード、トリム
                //console.log("username["+username+"]");
            }

            function loadSelectBox(){
                //username = $("#text_username").val();
                if(username === ""){
                    return;
                }
                console.log("username["+username+"]");
                steem.api.getDiscussionsByBlog({tag: username, limit: 20}, function(err, result) {
                    let text = "";
                    console.log("result["+result+"]");
                    for(let i = 0; i < result.length; i++){
                        if(result[i].author === username){
                            text += '<option value="' + result[i].permlink+ '">' + result[i].title + '</option>';
                        }
                    }
                    console.log("text["+text+"]");
                    if(result.length == 0) {
                        $("#selectPerm").html("");
                        $("#votingListButton").text("");
                        $("#votingListButton").val("");
                        return;
                    }
                    $("#selectPerm").html(text);
                    getVoting("SBD");
                });
            }
            
            
            async function getVoting(orderby){
                let link = $("#selectPerm").val();
                username = $("#text_username").val();
                console.log(username);
                let steemPrice = await steem.api.getCurrentMedianHistoryPriceAsync();
                console.log(steemPrice);
                steemPrice = parseFloat(steemPrice.base.replace(" SBD"));
                console.log(steemPrice);
                let fund = await steem.api.getRewardFundAsync('post');
                console.log(fund);
                let replies = await steem.api.getContentRepliesWithAsync({author:username, permlink:link});
                console.log( replies);
                replies = replies.map(function(item, index){
                        return item.author;
                });
                console.log( replies);
                //let result = await steem.api.getActiveVotesAsync(username, link);
                //console.log( result);
            }
            
            window.onload = function() {
                steem.api.setOptions({url: 'https://api.steemit.com'});
                saveUserName();
                loadSelectBox();
            };
        </script>
    </head>
    <body>
        <div>
            こんにちは、
        </div>
        <h1 id="harts"></h1>
    
        <select class="custom-select" id="selectPerm" onchange='getVoting("SBD");'>
        </select>
    </body>
</html>
