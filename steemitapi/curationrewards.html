<!doctype html>
<html lang="en">
    <head>
        <title>curationrewards</title>
        <meta charset="utf-8">
        <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
        <script src="https://github.com/steemit/steem-js/releases/download/v0.7.7/steem.min.js"></script>
        <script src="https://ojagggyo.github.io/steemitapi/ownerhistory.js"></script>
        
<script>
      
steem.api.setOptions({url: 'https://api.steemit.com'});    

async function getAccountInfo(usernames){
  let data = [];
  document.getElementById("text").innerHTML = '<tabel></tabel>';
  for(var i=0;i<usernames.length;i=i+1){  
    document.getElementById("progress").innerText = ' ' + (i + 1) + ' / ' + usernames.length;
    let accounts = await steem.api.getAccountsAsync([usernames[i]]);
    if(accounts.length == 0) continue;//アカウントなし
    data.push({'n':usernames[i],'a':accounts[0]}); 
  }
  console.log(data);
    
    data.sort(function(a,b){
        if(a.a.curation_rewards < b.a.curation_rewards) return -1;
        if(a.a.curation_rewards > b.a.curation_rewards) return 1;
        return 0;
    });
    console.log(data)
    
  return data;
}

function clickBtn() {
  let t1 = document.getElementById("text1").value;
  let csv = t1.split(/\n/);//改行で分割する
  getAccountInfo(csv).then(result => {
      console.log('☆result☆');
      console.log(result);
    html = '<table border=1';
      //テーブルのヘッダー
    html = html + '<tr>';
    html = html + '<th>Name</th>'
      +'<th>curation rewards</th>';
    html = html + '</tr>';
    for(var i=0;i<result.length;i=i+1){
      html = html + '<tr>';
      html = html + '<td>' + result[i].n + '</td>';
      html = html + '<td align=right>' + result[i].a.curation_rewards + '</td>';
      html = html + '</tr>';
    }
    html = html + '</table>';
    console.log(html);
    document.getElementById("text").innerHTML = html;
  }).catch(err => {
    console.log('☆');
    console.log(err);
  }); 
}
</script>
        
    </head>
    <body>        
        <p>アカウント名を入力してください。</p>
        <textarea id="text1" rows="10" cols="20">yasu
japansteemit</textarea>
        <br/>
        <input type="button" value="キュレーションリワードを表示する" onclick="clickBtn()" /><a id="progress"></a>
        <span id="text"></span>
    </body>
</html>
