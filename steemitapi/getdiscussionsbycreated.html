<!doctype html>
<html lang="en">
    <head>
        <title>getdiscussionsbycreated</title>
        <meta charset="utf-8">
        <script src="https://github.com/steemit/steem-js/releases/download/v0.7.7/steem.min.js"></script>
      <script>

function ConvertDate(datetime){
    time = new Date(datetime);
    time.setHours(time.getHours() + 9);
    return time.toLocaleString().slice(0,-3);//右から3文字カット
}
function donokuraimae(date){
 date1 = new Date(date);
 date1.setHours(date1.getHours() + 9);
  var now = new Date();
  sa = now - date1;
  
  if(sa >= 86400000){
    return Math.floor(sa / 86400000)+'日前';
  }
  if(sa >= 3600000){
    return Math.floor(sa / 3600000)+'時間前';
  }
  if(sa >= 60000){
    return Math.floor(sa / 60000)+'分前';
  }
  if(sa >= 1000){
    return Math.floor(sa / 1000)+'秒前';
  }
return 'たった今';
}

function getTags(json_string){
  const json = JSON.parse(json_string);
  console.log(json.tags);
  return json.tags.join(' ');
}
	      
          client = steem.api.setOptions({url: 'https://api.steemit.com'})
	
	      
async function aaa(){
	/*
    let tags = [];
	let limit = 10;
	let lastTag = "";
	while (limit == 10 && tags.length < 50){
		let ret = await steem.api.getTrendingTagsAsync(lastTag, limit);
		console.log(ret);
		limit = ret.length;
		lastTag = ret[ret.length - 1].name;
		tags.pop();
		tags = tags.concat(ret);
	}
	console.log("☆");
	console.log(tags);

	return tags;
	});
    */
    
    let query = { limit : 20, tag : "hive-161179" };
    let ret = steem.api.getDiscussionsByCreatedAsync(query);
    console.log(ret);
	return ret;

};
	
aaa().then(result => {
	console.log('☆result☆');
	console.log(result);
	html = '<table border=1 >';
	//テーブルのヘッダー
	html = html + '<tr>';
	html = html + '<th></th><th>author</th><th>title</th><th>beneficiaries</th><th>tags</th>';
	html = html + '</tr>';
	for(i=0; i<result.length; i=i+1){
		html = html + '<tr>';
		html = html + '<td align=right>' + donokuraimae(result[i].created) + '</td>';//
		html = html + '<td><a href=' + 'https://steemit.com/@' + result[i].name + ' target=_blank>' + result[i].author + '</a></td>';
		html = html + '<td>' + result[i].title + '</td>';
		html = html + '<td align=right>';
		
		for(j=0; j<result[i].beneficiaries.length; j++){
			html = html + result[i].beneficiaries[j].account + ' ';
			html = html + result[i].beneficiaries[j].weight.toString().slice(0,-2) + '%';
			html = html + '<br/>';
		}
		
		html = html + '</td>';
		html = html + '<td align=right>' + getTags(result[i].json_metadata) + '</td>';
		html = html + '</tr>';
	}
	html = html + '</table>';
	console.log(html);
	document.getElementById("text").innerHTML = html;
	}).catch(err => {
	console.log('☆');
	console.log(err);
});
        </script>
    </head>
    <body>        
        <p>ディスカッションを表示します。</p>
        <span id="text"></span>
        <!-- <script src="https://ojagggyo.github.io/steemitapi/gettrendingtags.js"></script> -->
    </body>
</html>

