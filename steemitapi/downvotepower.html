<!doctype html>
<html lang="en">
    <head>
        <title>steempower</title>
        <meta charset="utf-8">
        <script src="https://github.com/steemit/steem-js/releases/download/v0.7.7/steem.min.js"></script>
        <script src="https://ojagggyo.github.io/steemitapi/steempower.js"></script>
        
<script>
steem.api.setOptions({url: 'https://api.steemit.com'})
    
function getDownvotePower(id) {
    return new Promise((resolve, reject) => {
        steem.api.getAccounts([id], function(err, response) {
            if (err) reject(err);
            const current_mana = response[0].voting_manabar.current_mana;
            const downvote_mana = response[0].downvote_manabar.current_mana;
            const downvote_last_update_time = response[0].downvote_manabar.last_update_time;
            const downvote_per = downvote_mana / (current_mana / (response[0].voting_power / 100) / 4);          
            const secondsago = (new Date - new Date(downvote_last_update_time * 1000)) / 1000;
            let vpow = downvote_per * 100 + (10000 * secondsago / 432000);
            //resolve(Math.min(vpow / 100, 100).toFixed(2));
            resolve((vpow / 100).toFixed(2));
        });          
    });
}
 
// Sample Usage
(async function() {
    const val = await getDownvotePower('yasu');
    console.log(val);
})();
</script>
    </head>
    <body>        
        <p>アカウント名を入力してください。</p>
        <textarea id="text1" rows="10" cols="20">yasu
japansteemit</textarea>
        <br/>
        <input type="button" value="DOWNVOTE POWERを表示する" onclick="clickBtn()" /><a id="progress"></a>
        <span id="text"></span>
    </body>
</html>
