<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let myChart;

function clickBtn(days) {
  let t1 = document.getElementById("text1").value;
  let csv = t1.split(/\n/);//改行で分割する
  console.log(csv);

  //2次元を2個の1次元に変換する。
  let labels = [];
  let datas = [];
  for(var i=0;i<csv.length;i=i+1){
    row = csv[i].split(/,/);
    labels.push(row[0]);
    datas.push(row[1]);
  }

  const data = {
    labels: labels,
    datasets: [{
      label: '新規陽性者数',
      backgroundColor: 'rgb(51, 221, 204)',
      borderColor: 'rgb(51, 221, 204)',
      data: datas,
    }]
  };
	
if(days > 0){
	labels = labels.slice(labels.length - days, labels.length);
	datas = datas.slice(datas.length - days, datas.length);
}

  // === include 'setup' then 'config' above ===
  const config = {
  type: 'bar',
    data: data,
    options: {}
  };

  if(myChart != null){
    myChart.destroy();
  }
  myChart = new Chart(
      document.getElementById('myChart'), config);
}
  
  //----------------------------------------------------------
let myChart2;

function clickBtn2(days) {
  let t1 = document.getElementById("text2").value;
  let csv = t1.split(/\n/);//改行で分割する
  console.log(csv);

  //2次元を2個の1次元に変換する。
  let labels = [];
  let datas = [];
  let before = 0;

  if(csv.length > 0){
    before = parseFloat('0' + csv[0].split(/,/)[1]);
    for(var i=1; i<csv.length; i=i+1){
      row = csv[i].split(/,/);
      labels.push(row[0]);
      datas.push(parseFloat(row[1]) - before);
      before = parseFloat(row[1]);
    }
  }
	
if(days > 0){
	labels = labels.slice(labels.length - days, labels.length);
	datas = datas.slice(datas.length - days, datas.length);
}

  const data = {
    labels: labels,
    datasets: [{
	label: '死亡者数',
      backgroundColor: 'orange',
      borderColor: 'orange',
      data: datas,
    }]
  };

  // === include 'setup' then 'config' above ===
  const config = {
  type: 'bar',
    data: data,
    options: {}
  };

  if(myChart2 != null){
    myChart2.destroy();
  }
  myChart2 = new Chart(
      document.getElementById('myChart2'), config);
}  
  
 
window.onload = function() {
	var req1 = new XMLHttpRequest();
	req1.open("get", "./omicron_20220109_1.csv", true);	// アクセスするファイルを指定
	req1.send(null);
	req1.onload = function(){
		document.getElementById('text1').value = req1.responseText;
	}
	var req2 = new XMLHttpRequest();
	req2.open("get", "./omicron_20220109_2.csv", true);	// アクセスするファイルを指定
	req2.send(null);
	req2.onload = function(){
		document.getElementById('text2').value = req2.responseText;
	}
}
  
</script>
  </head>
  
  <!-- -------------------------------------------------------------- -->
  
  <body>

<table border=1>
<tr>
<td width=0%>
新規陽性者数データを入力してください。
<textarea id="text1" rows="10" cols="20"></textarea>
<br/>
<input type="button" value="チャートを表示する" onclick="clickBtn(0)" />
</td> 
<td width=100%>
<div>
<canvas id="myChart"></canvas>
</div>
</td>  
</tr>  

<tr>
<td>
死亡者数データを入力してください。<br/>
<span>例）<br/>
日付,累計値<br/></span>
<textarea id="text2" rows="10" cols="20"></textarea>
<br/>
<input type="button" value="チャートを表示する" onclick="clickBtn2(0)" />
</td>
<td>
<div>
<canvas id="myChart2"></canvas>
</div
</td>
</tr>
 
</table>  
  
<!-- ------------------------------------------------------ -->

<input type="button" value="7日間" onclick="clickBtn(7);clickBtn2(7);" />
<input type="button" value="14日間" onclick="clickBtn(14);clickBtn2(14);" />
<input type="button" value="30日間" onclick="clickBtn(30);clickBtn2(30);" />
<input type="button" value="60日間" onclick="clickBtn(60);clickBtn2(60);" />
<input type="button" value="90日間" onclick="clickBtn(90);clickBtn2(90);" />
<input type="button" value="120日間" onclick="clickBtn(120);clickBtn2(120);" />
<input type="button" value="150日間" onclick="clickBtn(150);clickBtn2(150);" />
  </body>
</html>
